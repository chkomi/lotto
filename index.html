<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>로또 번호 분석 시스템 - 엔트로피 가중치법</title>
    <!-- Pretendard 폰트 (KRDS에서 사용하는 폰트와 유사) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>로또 번호 분석 시스템</h1>
            <p>엔트로피 가중치법을 활용한 데이터 기반 번호 예측 및 분석</p>
        </div>
    </header>

    <div class="container">
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('prediction')">예측</button>
            <button class="tab" onclick="switchTab('backtest')">백테스팅</button>
            <button class="tab" onclick="switchTab('statistics')">통계</button>
            <button class="tab" onclick="switchTab('about')">설명</button>
        </div>

        <!-- Tab: Prediction -->
        <div id="tab-prediction" class="tab-content active">
            <!-- 데이터 업데이트 안내 -->
            <div class="card card-compact" id="update-info-card" style="display: none; margin-bottom: var(--spacing-md); background: linear-gradient(135deg, #eff6ff, #ffffff); border: 2px solid #3b82f6;">
                <div class="card-header-compact">
                    <h2 class="card-title-compact">🔄 데이터 업데이트</h2>
                </div>
                <div style="padding: 12px;">
                    <div id="update-status" style="margin-bottom: 12px; font-size: 0.875rem;"></div>
                    <button class="btn btn-primary" onclick="checkAndUpdateData()" style="width: 100%;">
                        📥 최신 회차 확인 및 업데이트
                    </button>
                    <small style="display: block; margin-top: 8px; color: var(--text-secondary); font-size: 0.75rem;">
                        💡 동행복권(https://dhlottery.co.kr)에서 최신 당첨번호를 확인한 후 입력해주세요.
                    </small>
                </div>
            </div>

            <!-- Controls - 컴팩트하게 -->
            <div class="card card-compact">
                <div class="card-header-compact">
                    <h2 class="card-title-compact">⚙️ 분석 설정</h2>
                </div>
                <div class="controls-compact">
                    <div class="control-group-compact">
                        <label for="analysis-method">분석 방법</label>
                        <select id="analysis-method">
                            <option value="entropy">엔트로피 가중치법</option>
                            <option value="topsis">TOPSIS</option>
                            <option value="ensemble">앙상블</option>
                            <option value="randomForest">Random Forest</option>
                            <option value="association">연관 규칙</option>
                            <option value="mathConstants">수학적 상수</option>
                        </select>
                    </div>
                    <div class="control-group-compact">
                        <label for="analyze-rounds">분석 범위</label>
                        <input type="number" id="analyze-rounds" value="50" min="10" max="500">
                        <small>현재: <strong id="current-window">50</strong>회차</small>
                    </div>
                    <div class="control-group-compact">
                        <label for="predict-count">표시 개수</label>
                        <input type="number" id="predict-count" value="10" min="6" max="20">
                    </div>
                    <div class="control-group-compact" style="display: flex; align-items: flex-end;">
                        <button class="btn btn-primary" onclick="runNextRoundPrediction()" style="width: 100%;">
                            🎯 예측 실행
                        </button>
                    </div>
                </div>
            </div>

            <!-- 4열 메인 그리드: 예측 번호, 조합, 가중치, 차트를 모두 나란히 -->
            <div class="main-content-grid">
                <!-- 예측 번호 -->
                <div class="card card-compact card-with-scroll">
                    <div class="card-header-compact">
                        <h2 class="card-title-compact">🎯 예측 번호</h2>
                        <div id="next-round-info" style="font-size: 0.7rem; color: #64748b; text-align: right;"></div>
                    </div>
                    <div id="prediction-results" class="prediction-grid-compact">
                        <!-- Predictions will be inserted here -->
                    </div>
                </div>

                <!-- 추천 조합 -->
                <div class="card card-compact card-with-scroll">
                    <div class="card-header-compact">
                        <h2 class="card-title-compact">🎲 추천 조합</h2>
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <input type="number" id="combination-count" value="5" min="3" max="20" 
                                   style="width: 50px; padding: 4px 6px; font-size: 0.75rem;">
                            <button class="btn btn-success" onclick="generateCombinations()" 
                                    style="padding: 4px 8px; font-size: 0.75rem; min-height: 28px;">
                                생성
                            </button>
                        </div>
                    </div>
                    <div id="combinations-results" class="combinations-compact">
                        <!-- Combinations will be inserted here -->
                        <div style="text-align: center; padding: 16px; color: #94a3b8; font-size: 0.8rem;">
                            조합 생성 버튼 클릭
                        </div>
                    </div>
                </div>

                <!-- 특성별 가중치 -->
                <div class="card card-compact card-with-scroll">
                    <div class="card-header-compact">
                        <h2 class="card-title-compact">특성 가중치</h2>
                    </div>
                    <div id="weights-display" class="weights-container-compact">
                        <!-- Weights will be inserted here -->
                    </div>
                </div>

                <!-- 전체 번호 점수 차트 -->
                <div class="card card-compact card-with-scroll">
                    <div class="card-header-compact">
                        <h2 class="card-title-compact">번호 점수</h2>
                    </div>
                    <div class="chart-container-compact">
                        <canvas id="scores-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Backtest -->
        <div id="tab-backtest" class="tab-content">
            <!-- Explanation -->
            <div class="card" style="background: linear-gradient(135deg, #eff6ff, #dbeafe); border: 2px solid #3b82f6;">
                <div style="padding: 16px;">
                    <h3 style="margin: 0 0 8px 0; color: #1e40af;">📊 백테스팅이란?</h3>
                    <p style="margin: 0; color: #1e3a8a; font-size: 0.9rem; line-height: 1.6;">
                        과거 데이터로 예측 모델을 테스트하는 방법입니다. "만약 이전에 이 방법을 사용했다면 얼마나 정확했을까?"를 확인할 수 있습니다.<br>
                        <strong>Walk-Forward 방식</strong>은 미래 정보를 사용하지 않고 순차적으로 테스트하여 더 현실적인 성능을 보여줍니다.
                    </p>
                </div>
            </div>

            <!-- Backtest Controls -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">⚙️ 백테스팅 설정</h2>
                </div>
                <div class="controls">
                    <div class="control-group">
                        <label for="backtest-start">시작 회차</label>
                        <input type="number" id="backtest-start" value="1100" min="100">
                    </div>
                    <div class="control-group">
                        <label for="backtest-end">종료 회차</label>
                        <input type="number" id="backtest-end" value="1150" min="100">
                    </div>
                    <div class="control-group">
                        <label for="backtest-topn">예측 번호 개수</label>
                        <input type="number" id="backtest-topn" value="10" min="6" max="20">
                    </div>
                    <div class="control-group">
                        <label for="backtest-mode">백테스트 모드</label>
                        <select id="backtest-mode" title="백테스트 방식을 선택하세요." onchange="toggleBacktestMode()">
                            <option value="standard">표준 백테스트</option>
                            <option value="walkforward">Walk-Forward 백테스트</option>
                        </select>
                        <small style="color: #64748b; font-size: 0.8rem;">
                            Walk-Forward는 시계열 무결성을 보장합니다.
                        </small>
                    </div>
                    <div class="control-group" id="walkforward-config" style="display: none;">
                        <label>Walk-Forward 설정</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div>
                                <label for="wf-train-size" style="font-size: 0.9rem;">학습 기간</label>
                                <input type="number" id="wf-train-size" value="100" min="50" max="500">
                            </div>
                            <div>
                                <label for="wf-test-size" style="font-size: 0.9rem;">테스트 기간</label>
                                <input type="number" id="wf-test-size" value="50" min="10" max="200">
                            </div>
                        </div>
                        <div style="margin-top: 8px;">
                            <label for="wf-window-type" style="font-size: 0.9rem;">윈도우 타입</label>
                            <select id="wf-window-type">
                                <option value="rolling">Rolling Window (이동 윈도우)</option>
                                <option value="anchored">Anchored Window (시작점 고정)</option>
                            </select>
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="backtest-method">분석 방법</label>
                        <select id="backtest-method" title="백테스트에 사용할 분석 방법을 선택하세요.">
                            <option value="entropy">엔트로피 가중치법 (Entropy)</option>
                            <option value="topsis">TOPSIS 방법</option>
                            <option value="randomForest">Random Forest</option>
                            <option value="association">연관 규칙 분석</option>
                            <option value="mathConstants">수학적 상수 분석 (e, π, φ)</option>
                            <option value="ensemble">앙상블 (엔트로피 + TOPSIS)</option>
                        </select>
                        <small style="color: #64748b; font-size: 0.8rem;">
                            각 방법의 성능을 비교해보세요.
                        </small>
                    </div>
                    <button class="btn btn-success" onclick="runBacktest()">
                        ▶️ 백테스트 실행
                    </button>
                    <button class="btn btn-secondary" onclick="exportBacktestResults()">
                        💾 결과 내보내기
                    </button>
                </div>
            </div>

            <!-- Backtest Statistics -->
            <div id="backtest-stats" class="grid grid-3">
                <!-- Stats will be inserted here -->
            </div>

            <!-- Backtest Chart -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">백테스트 성능 추이</h2>
                </div>
                <div class="chart-container">
                    <canvas id="backtest-chart"></canvas>
                </div>
            </div>

            <!-- Hit Distribution -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">적중 개수 분포</h2>
                </div>
                <div class="chart-container">
                    <canvas id="hit-distribution-chart"></canvas>
                </div>
            </div>

            <!-- Detailed Results -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">상세 결과</h2>
                </div>
                <div class="table-wrapper">
                    <table class="backtest-table" id="backtest-table">
                        <thead>
                            <tr>
                                <th>회차</th>
                                <th>예측 번호</th>
                                <th>실제 번호</th>
                                <th>적중</th>
                                <th>평균 순위</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Results will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Strategy Optimization -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">⚙️ 전략 파라미터 최적화</h2>
                </div>
                <div class="controls">
                    <div class="control-group">
                        <label for="opt-metric">최적화 목표 지표</label>
                        <select id="opt-metric">
                            <option value="hit_rate_3">3개+ 적중률</option>
                            <option value="hit_rate_4">4개+ 적중률</option>
                            <option value="average_hits">평균 적중 개수</option>
                            <option value="lift_3">무작위 대비 리프트 (3개+)</option>
                            <option value="sharpe_ratio">안정성 지수 (Sharpe-like)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>분석 윈도우 크기 (회차)</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <label><input type="checkbox" name="opt-window" value="30"> 30</label>
                            <label><input type="checkbox" name="opt-window" value="50" checked> 50</label>
                            <label><input type="checkbox" name="opt-window" value="100" checked> 100</label>
                            <label><input type="checkbox" name="opt-window" value="150"> 150</label>
                            <label><input type="checkbox" name="opt-window" value="200"> 200</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="opt-backtest-range">최적화용 백테스트 범위</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div>
                                <label style="font-size: 0.9rem;">시작 회차</label>
                                <input type="number" id="opt-backtest-start" value="1000" min="100">
                            </div>
                            <div>
                                <label style="font-size: 0.9rem;">종료 회차</label>
                                <input type="number" id="opt-backtest-end" value="1150" min="100">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="runOptimization()">
                        🔍 Grid Search 실행
                    </button>
                    <small style="color: #64748b; font-size: 0.8rem; display: block; margin-top: 8px;">
                        ⚠️ 최적화는 시간이 걸릴 수 있습니다. 선택한 윈도우 크기 조합 수에 따라 다릅니다.
                    </small>
                </div>
                <div id="optimization-results" style="margin-top: 20px;">
                    <!-- Optimization results will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Tab: Statistics -->
        <div id="tab-statistics" class="tab-content">
            <!-- Overall Stats -->
            <div class="grid grid-3">
                <div class="stat-box">
                    <div class="stat-value" id="total-rounds">0</div>
                    <div class="stat-label">전체 회차</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="most-frequent">-</div>
                    <div class="stat-label">최다 출현 번호</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="least-frequent">-</div>
                    <div class="stat-label">최소 출현 번호</div>
                </div>
            </div>

            <!-- Number Frequency -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">번호별 출현 빈도</h2>
                </div>
                <div class="chart-container" style="height: 400px;">
                    <canvas id="frequency-chart"></canvas>
                </div>
            </div>

            <!-- Section Distribution -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">구간별 분포</h2>
                </div>
                <div class="chart-container">
                    <canvas id="section-chart"></canvas>
                </div>
            </div>

            <!-- Odd/Even Ratio -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">홀짝 비율</h2>
                </div>
                <div class="chart-container">
                    <canvas id="oddeven-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tab: About -->
        <div id="tab-about" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">엔트로피 가중치법이란?</h2>
                </div>
                <div style="line-height: 1.8;">
                    <h3 style="margin-top: 20px; color: var(--primary-color);">📊 개념</h3>
                    <p>엔트로피 가중치법(Entropy Weight Method)은 정보 이론의 엔트로피 개념을 활용하여 각 평가 지표의 가중치를 객관적으로 결정하는 방법입니다.</p>

                    <h3 style="margin-top: 20px; color: var(--primary-color);">🔢 핵심 원리</h3>
                    <ul style="margin-left: 20px;">
                        <li><strong>엔트로피가 낮을수록</strong> → 정보량이 많음 → 가중치가 높음</li>
                        <li><strong>엔트로피가 높을수록</strong> → 정보량이 적음 → 가중치가 낮음</li>
                    </ul>

                    <h3 style="margin-top: 20px; color: var(--primary-color);">🎯 분석 특성 (8가지)</h3>
                    <ol style="margin-left: 20px;">
                        <li><strong>최근 출현 빈도</strong>: 최근 N회차 동안의 출현 횟수</li>
                        <li><strong>미출현 기간</strong>: 마지막 출현 이후 경과 회차 수</li>
                        <li><strong>출현 간격 패턴</strong>: 출현 간격의 규칙성/변동성</li>
                        <li><strong>홀짝 균형도</strong>: 최근 홀수/짝수 출현 비율</li>
                        <li><strong>구간 분포</strong>: 번호 구간(1-9, 10-18, 19-27, 28-36, 37-45) 분포</li>
                        <li><strong>연속 번호 패턴</strong>: 연속된 번호와의 동반 출현</li>
                        <li><strong>보너스 이력</strong>: 보너스로 출현한 이력</li>
                        <li><strong>평균 회귀</strong>: 전체 평균 출현률 대비 최근 출현률</li>
                    </ol>

                    <h3 style="margin-top: 20px; color: var(--primary-color);">🔢 수학적 상수 분석 (e, π, φ)</h3>
                    <p>무리수와 수학적 상수들을 활용한 분석 방법입니다:</p>
                    <ul style="margin-left: 20px;">
                        <li><strong>황금비(φ ≈ 1.618)</strong>: 피보나치 수열과 관련된 번호 간격 패턴 분석</li>
                        <li><strong>자연상수 e 기반 지수 감쇠</strong>: e^(-λt) 함수로 시간에 따른 가중치 적용</li>
                        <li><strong>π 주기 분석</strong>: sin/cos 함수로 출현 주기 패턴 예측</li>
                        <li><strong>피보나치 수열</strong>: 1, 1, 2, 3, 5, 8, 13, 21, 34... 관련 번호 분석</li>
                        <li><strong>소수 친화도</strong>: 소수(2, 3, 5, 7, 11...) 관련 패턴</li>
                        <li><strong>벤포드 법칙</strong>: 첫 자리 수 분포의 자연 법칙 (P(d) = log₁₀(1+1/d))</li>
                        <li><strong>오일러 가중치</strong>: e^(iπ) + 1 = 0 관련 상수 조합</li>
                        <li><strong>조화 평균</strong>: H = n / Σ(1/xᵢ) 기반 간격 분석</li>
                    </ul>

                    <h3 style="margin-top: 20px; color: var(--primary-color);">📈 백테스팅</h3>
                    <p>과거 데이터를 이용하여 모델의 예측 성능을 검증합니다. 슬라이딩 윈도우 방식으로 각 회차를 예측하고 실제 당첨 번호와 비교하여 정확도를 측정합니다.</p>

                    <h3 style="margin-top: 20px; color: var(--primary-color);">⚠️ 중요 안내</h3>
                    <p style="color: var(--danger-color); font-weight: 500;">이 시스템은 교육 및 연구 목적으로 제작되었습니다. 로또는 완전한 무작위 추첨이므로 어떠한 분석 방법도 당첨을 보장할 수 없습니다. 과도한 구매는 삼가시기 바랍니다.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/lotto-data.js"></script>  <!-- 데이터 먼저 로드 -->
    <script src="js/entropy.js"></script>
    <script src="js/analyzer.js"></script>
    <script src="js/topsis.js"></script>
    <script src="js/random-forest.js"></script>
    <script src="js/association-rules.js"></script>
    <script src="js/math-constants.js"></script>  <!-- 수학적 상수 분석 (e, π, φ) -->
    <script src="js/ensemble.js"></script>
    <!-- 조합 생성 모듈 -->
    <script src="js/combination/constraints.js"></script>
    <script src="js/combination/scorer.js"></script>
    <script src="js/combination/generator.js"></script>
    <!-- Walk-Forward 백테스팅 모듈 -->
    <script src="js/backtest/metrics.js"></script>
    <script src="js/backtest/walkforward.js"></script>
    <script src="js/backtest/optimizer.js"></script>
    <script src="js/backtest.js"></script>
    <!-- 회차 자동 계산 모듈 -->
    <script src="js/round-calculator.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
